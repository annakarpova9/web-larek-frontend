# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные продукта

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: EProductCategory;
	price: number | null;
}
```

Данные категории продукта

```
enum EProductCategory {
	'софт-скил' = 'soft',
	'хард-скил' = 'hard',
	'другое' = 'other',
	'дополнительное' = 'additional',
	'кнопка' = 'button',
}
```

Данные заказа

```
export interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number | null;
	items: string[];
}
```

Тип данных форм заказа

```
type IOrderForm = Partial<Omit<IOrder, 'total' | 'items'>>
```

Тип данных ошибок форм заказа

```
type TFormErrors = Partial<Record<keyof IOrderForm, string>>
```

Тип данных при отправке заказа на сервер

```
interface IOrderResult {
	id: string;
	total: number;
}
```

Тип данных Api

```
type TApiPostMethods = 'POST' | 'PUT';

interface IApi {
	baseUrl: string;
	get<T>(uri: string): Promise<T>;
	post<T>(uri: string, data: object, method?: TApiPostMethods): Promise<T>;
}
```

Тип событий

```
export enum Events {
	CARDS_ADDED = 'cards:added',
	PREVIEW_SELECT = 'preview:select',
	MODAL_OPEN = 'modal:open',
	MODAL_CLOSE = 'modal:close',
	PRODUCT_ADD_TO_BASKET = 'product:add-to-basket',
	PRODUCT_DELETE_FROM_BASKET = 'product:delete-from-basket',
	BASKET_CHANGE = 'basket:change',
	ORDER_OPEN = 'order:open',
	ORDER_SUBMIT = 'order:submit',
	FORM_ERRORS_CHANGE = 'formErrors:change',
	CONTACTS_SUBMIT = 'contacts:submit',
	ORDER_READY = 'order:ready',
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных(Model) хранит, предоставляет и изменяет данные для пользовательского интерфейса,
- слой представления(View) реализует отображение данных на странице приложения,
- презентер(Presenter) отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductModel

Класс отвечает за хранение и логику работы с данными продукта.\
В полях класса хранятся следующие данные:

- `id: string;` - идентификатор продукта;
- `description: string;` - описание продукта;
- `image: string;` - изображение продукта;
- `title: string;` - название продукта;
- `category: EProductCategory;` - категория продукта;
- `price: number | null;` - цена продукта;
- `buttonState: { stateIsNull: boolean; stateInBasket: boolean };` - состояние кнопки;
- `index: number;` - индекс продукта в списке;

Также класс предоставляет методы для взаимодейсвтия с данными карточки:

- `getStateIsNull(): boolean` - возвращает истину или ложь при нулевой цене.

#### Класс AppModel

Класс отвечает за хранение и логику работы приложения.\
В полях класса хранятся следующие данные:

- `catalog: ProductModel[];` - каталог продуктов;
- `basket: IProduct[] = [];` - каталог продуктов в корзине;
- `order: IOrder = {
	payment: null,
	email: '',
	phone: '',
	address: '',
	total: null,
	items: [],
};` - заказ;
- `formErrors: TFormErrors = {};` - ошибки форм заказа.

Также класс предоставляет методы взаимодействия с данными:

- `setCatalog(items: IProduct[]): void;` - записывает каталог с сервера;
- `getInBasket(product: IProduct): boolean;` - проверяет наличие продукта в корзине;
- `getTotal(): number;` - получает полную сумму заказа;
- `addToBasket(product: IProduct): void;` - добавляет продукт в корзину;
- `removeFromBasket(product: IProduct): void;` - удаляет продукт из корзины;
- `clearBasket(): void;` - очищает корзину;
- `clearOrder(): void;` - очищает заказ;
- `setOrderField(field: keyof IOrderForm, value: string): void;` - записывает данные инпутов в данные заказа;
- `validateContacts(): boolean;` - проверяет валидацию формы `contacts`;
- `validateOrder(): boolean;` - проверяет валидацию формы `order`;

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод `render` для отображения данных в компоненте.\
В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод `render`, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс ModalView

Реализует модальное окно. Устанавливает слушатели на клавиатуру, на клик в оверлей и кнопку-крестик для закрытия попапа.
Наследуется от базового класса `Сomponent`.

- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает контейнер, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_content: HTMLElement;` - элемент для размещения контента;
- `_closeButton: HTMLButtonElement;` - кнопка закрытия модального окна;

Методы класса:

- `open` - открытие модального окна;
- `close` - закрытие модального окна;
- `render` - отрисовка в контейнере;
- а также сеттер для контента.
-

#### Класс FormView

Предназначен для реализации элементов формы содержащей поля ввода./
Наследуется от базового класса `Сomponent`.

При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:

- `_formErrors: HTMLElement` - элемент для вывода ошибок валидации;
- `_submitButton: HTMLButtonElement` - кнопка подтверждения.

Методы:

- `onInputChanged(field: keyof T, value: string)` - инициирует событие изменения полей форм ввода, возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем;
- `render(state: Partial<T> & IFormState)` - собирает и возвращает контейнер с формой;
- а также сеттеры для изменения активности кнопки и размещения текста ошибок.

Классы `ContactsView` и `OrderView` расширают класс Form, определяя конкретные поля ввода данных.

#### Класс BasketView

Предназначен для реализации отображения корзины товаров. Получает данные товаров в корзине, которые нужно отобразить.\
Наследуется от базового класса `Сomponent`.
Конструктор принимает HTMLElement контейнера, по которому в разметке страницы будет идентифицирован темплейт, а также принимает интерфейс `IBasketActions` для инициации событий.

Поля класса:

- `_list: HTMLElement` - элемент разметки со списком
- `_total: HTMLElement` - элемент разметки для вывода общей суммы заказа
- `_actionButton: HTMLButtonElement` - элемент разметки кнопки оформления заказа

Методы:

- `disabledActionButton` - меняет активность кнопки в корзине;
- `render(data: IBasketView)` - собирает и возвращает контейнер с корзиной;
- а также сеттеры для элементов карточки.

#### Класс SuccessView

Предназначен для реализации отображения успешной оплаты заказа. Получает данные суммы списания, которые нужно отобразить.\
Класс наследуется от базового `Component`.\
Конструктор принимает HTMLElement контейнера, по которому в разметке страницы будет идентифицирован темплейт и интерфейс `ISuccessActions` для возможности инициации событий.

Поля класса:

- `_total: HTMLElement`- элемент разметки для вывода общей суммы;
- `_successButton: HTMLButtonElement` - элемент разметки кнопки перейти к покупкам.

Методы:

- сеттер для вывода общей суммы оплаты.

#### Класс Card

Отвечает за отображение карточки товара, задавая в карточке данные названия, цены, а также кнопки.
Класс наследуется от базового `Component`. Конструктор принимает HTMLElement контейнера и интерфейс `ICardActions` для инициации событий.

Классы `CardCatalog`, `CardPreview` и `CardBasket` наследаются от класса `Card`.

В классах устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля классов содержат элементы разметки элементов карточки.\

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью инициации событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:
- `cards:added` - изменение массива карточек;
- `preview:selected` - изменение открываемой в модальном окне картинки карточки;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `product:add-to-basket` - продукт добавлен в корзину;
- `product:delete-from-basket` - продукт удален из корзины;
- `basket:open` - открытие корзины;
- `basket:change` - корзина изменилась;
- `order:open` - открыта форма заказа;
- `order.payment:change` - изменилось поле оплаты заказа;
- `order.address:change` - изменилось поле адреса заказа;
- `contacts.email:change` - изменилось поле почты заказа;
- `contacts.phone:change` - изменилось поле телефона заказа;
- `order:submit` - открыта вторая форма заказа;
- `formErrors:change` - изменились ошибки;
- `contacts:submit` - заказ корректно заполнен;
- `order:ready` - заказ готов;
- `order:clean` - заказ очищен.
